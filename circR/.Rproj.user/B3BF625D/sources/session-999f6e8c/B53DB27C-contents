find_offset <- function(df, rolling_offset = 30) {
  df <- df %>%
    arrange(timestamp) %>%
    mutate(rolling_mean_offset = rollmean(HopsPerMinute, k = rolling_offset, fill = NA, align = "right"))

  daily_mean <- mean(df$HopsPerMinute, na.rm = TRUE)
  offset_time <- df %>%
    filter(rolling_mean_offset > daily_mean) %>%
    slice_tail(n = 1) %>%
    pull(timestamp)

  if (length(offset_time) == 0) {
    offset_time <- NA
  }

  df <- df %>%
    mutate(daily_mean = daily_mean,
           offset_time = offset_time)

  return(df)
}
